global
        daemon

defaults
        log global
        mode tcp
        option tcplog

        option dontlognull
        #maxconn 2000
        timeout connect 24h
        timeout client 24h
        timeout server 24h

frontend ssl
        mode tcp
        bind *:443 ssl crt /etc/letsencrypt/live/v2ray.opinion.works
        tcp-request inspect-delay 5s
        tcp-request content accept if { req.ssl_hello_type 1 }

        acl tls req.ssl_hello_type 1
        acl has_sni req.ssl_sni -m found
        acl ssh_payload payload(0,7) -m bin 5353482d322e30


        use_backend v2ray if tls { req.ssl_sni -i v2ray.opinion.works }
        #use_backend ss if tls { req.ssl_sni -i ss.opinion.works }
        use_backend nginx if tls has_sni
        default_backend v2ray

backend v2ray
        mode tcp
        server v2ray v2ray:8443

# backend ss
#         mode tcp
#         server ss ss:8443

backend nginx
        mode http
        redirect location https://opinion.works