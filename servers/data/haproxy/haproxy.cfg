global
        daemon
        log stdout format raw daemon

defaults
        log global
        mode tcp
        option tcplog

        option dontlognull
        #maxconn 2000
        timeout connect 24h
        timeout client 24h
        timeout server 24h

frontend ssl
        mode tcp
        bind *:443 ssl crt /etc/letsencrypt/haproxy.pem
        tcp-request inspect-delay 5s

        use_backend vmess if { ssl_fc_sni -i v.opinion.works }
        use_backend ssr if { ssl_fc_sni -i s.opinion.works }
        default_backend nginx

backend vmess
        mode tcp
        server v2ray v2ray:80

backend ssr
        mode tcp
        server v2ray v2ray:81

backend nginx
        mode tcp
        server nginx nginx:80